<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Quotation Form</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  label { display: block; margin-top: 10px; }
  input, textarea { width: 100%; padding: 6px; margin-top: 4px; }
  button { margin-top: 10px; padding: 8px 12px; cursor: pointer; }
  iframe { width: 100%; height: 500px; border: 1px solid #ccc; margin-top: 20px; }
</style>
</head>
<body>

<h1>Quotation Creator</h1>

<form id="quoteForm">
  <label>Company Name: <input type="text" id="companyName"></label>
  <label>GST Number: <input type="text" id="gstNumber"></label>
  <label>Client Name: <input type="text" id="clientName"></label>
  <label>Quotation Number: <input type="text" id="quoteNumber"></label>
  <label>Date: <input type="date" id="quoteDate"></label>
  <label>Items (Name - Qty - Price): <textarea id="items"></textarea></label>
  <label>Terms & Conditions: <textarea id="terms"></textarea></label>
  <button type="button" onclick="previewPDF()">Preview</button>
  <button type="button" onclick="downloadPDF()">Download PDF</button>
</form>

<iframe id="previewFrame"></iframe>

<script>
function getFormData() {
  return {
    companyName: document.getElementById("companyName").value,
    gstNumber: document.getElementById("gstNumber").value,
    clientName: document.getElementById("clientName").value,
    quoteNumber: document.getElementById("quoteNumber").value,
    quoteDate: document.getElementById("quoteDate").value,
    items: document.getElementById("items").value,
    terms: document.getElementById("terms").value
  };
}

function previewPDF() {
  const data = encodeURIComponent(JSON.stringify(getFormData()));
  document.getElementById("previewFrame").src = `template.html?data=${data}`;
}

function downloadPDF() {
  const data = getFormData();
  const newWindow = window.open('', '_blank');
  fetch('template.html')
    .then(res => res.text())
    .then(html => {
      let populated = populateTemplate(html, data);
      newWindow.document.write(populated);
      newWindow.document.close();
      setTimeout(() => {
        const element = newWindow.document.body;
        html2pdf().from(element).save('quotation.pdf');
      }, 500);
    });
}

function populateTemplate(html, data) {
  return html.replace(/\$\{(.*?)\}/g, (_, key) => data[key.trim()] || '');
}
</script>

</body>
</html>
